<!-- 背景音乐播放器（隐藏UI，自动播放） -->
<div id="music-player" style="display: none;">
  <!-- 隐藏的小控制按钮，放在页面左下角 -->
  <div style="position: fixed; bottom: 20px; left: 20px; z-index: 1000;">
    <button id="toggle-music-btn" style="background: rgba(0, 0, 0, 0.5); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 18px;" title="播放/暂停音乐">⏸</button>
  </div>
  
  <audio id="background-music" loop preload="auto" volume="0.3" autoplay>
    <!-- 使用MP3格式，将你的音乐文件命名为 background.mp3 并放在 static/music/ 目录下 -->
    <source src="{{ "/music/background.mp3" | relURL }}" type="audio/mpeg">
  </audio>
</div>

<script>
(function() {
  const player = document.getElementById('background-music');
  const toggleBtn = document.getElementById('toggle-music-btn');
  
  let isPlaying = true; // 初始状态为播放中
  
  // 尝试自动播放
  function tryAutoplay() {
    const playPromise = player.play();
    
    if (playPromise !== undefined) {
      playPromise
        .then(() => {
          // 自动播放成功
          console.log('音乐自动播放成功');
        })
        .catch(error => {
          // 自动播放被阻止（浏览器策略）
          console.log('自动播放被阻止，需要用户交互');
          isPlaying = false;
          toggleBtn.textContent = '▶';
        });
    }
  }
  
  // 设置初始音量
  player.volume = 0.3;
  
  // 页面加载后尝试自动播放
  if (document.readyState === 'complete') {
    tryAutoplay();
  } else {
    window.addEventListener('load', tryAutoplay);
  }
  
  // 切换播放/暂停
  toggleBtn.addEventListener('click', function() {
    if (isPlaying) {
      player.pause();
      toggleBtn.textContent = '▶';
      isPlaying = false;
    } else {
      player.play();
      toggleBtn.textContent = '⏸';
      isPlaying = true;
    }
  });
  
  // 监听播放状态变化
  player.addEventListener('play', function() {
    toggleBtn.textContent = '⏸';
    isPlaying = true;
  });
  
  player.addEventListener('pause', function() {
    toggleBtn.textContent = '▶';
    isPlaying = false;
  });
  
})();
</script>

