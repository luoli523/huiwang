<!-- èƒŒæ™¯éŸ³ä¹æ’­æ”¾å™¨æ§åˆ¶é¢æ¿ -->
<div id="music-player-panel" style="position: fixed; top: 20px; right: 20px; z-index: 1000; background: rgba(255, 255, 255, 0.95); border-radius: 15px; padding: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); min-width: 250px;">
  <div style="display: flex; align-items: center; gap: 12px;">
    <!-- æ’­æ”¾/æš‚åœæŒ‰é’® -->
    <button id="toggle-music-btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 50%; width: 45px; height: 45px; cursor: pointer; font-size: 18px; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4); transition: all 0.3s;" title="æ’­æ”¾/æš‚åœéŸ³ä¹">â¸</button>
    
    <div style="flex: 1;">
      <!-- éŸ³ä¹æ ‡é¢˜ -->
      <div style="font-size: 14px; font-weight: 600; color: #333; margin-bottom: 4px;">èƒŒæ™¯éŸ³ä¹</div>
      
      <!-- è¿›åº¦æ¡å’ŒéŸ³é‡æ§åˆ¶ -->
      <div style="display: flex; align-items: center; gap: 8px;">
        <span style="font-size: 12px; color: #666;">ğŸ”Š</span>
        <input type="range" id="volume-control" min="0" max="100" value="30" style="flex: 1; height: 4px; border-radius: 2px; outline: none;" title="éŸ³é‡">
        <span style="font-size: 11px; color: #666; min-width: 30px; text-align: right;" id="volume-display">30%</span>
      </div>
    </div>
    
    <!-- å…³é—­æŒ‰é’® -->
    <button id="close-music-btn" style="background: none; border: none; font-size: 20px; cursor: pointer; color: #999; padding: 0; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;" title="å…³é—­éŸ³ä¹">Ã—</button>
  </div>
</div>

<audio id="background-music" loop preload="none" volume="0.3">
  <!-- ä½¿ç”¨MP3æ ¼å¼ï¼Œå°†ä½ çš„éŸ³ä¹æ–‡ä»¶å‘½åä¸º background.mp3 å¹¶æ”¾åœ¨ static/music/ ç›®å½•ä¸‹ -->
  <source src="/huiwang/music/background.mp3" type="audio/mpeg">
  <!-- å…¼å®¹æ€§æç¤º -->
  ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
</audio>

<script>
(function() {
  const player = document.getElementById('background-music');
  const toggleBtn = document.getElementById('toggle-music-btn');
  const volumeControl = document.getElementById('volume-control');
  const volumeDisplay = document.getElementById('volume-display');
  const closeBtn = document.getElementById('close-music-btn');
  const musicPanel = document.getElementById('music-player-panel');
  
  let isPlaying = false; // åˆå§‹çŠ¶æ€ä¸ºæœªæ’­æ”¾
  let isMinimized = false;
  
  // è®¾ç½®åˆå§‹éŸ³é‡
  player.volume = 0.3;
  
  // å°è¯•è‡ªåŠ¨æ’­æ”¾
  function tryAutoplay() {
    const playPromise = player.play();
    
    if (playPromise !== undefined) {
      playPromise
        .then(() => {
          console.log('ğŸµ éŸ³ä¹è‡ªåŠ¨æ’­æ”¾æˆåŠŸ');
          isPlaying = true;
          toggleBtn.textContent = 'â¸';
        })
        .catch(error => {
          console.log('âš ï¸ è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢:', error);
          isPlaying = false;
          toggleBtn.textContent = 'â–¶';
        });
    }
  }
  
  // é¡µé¢åŠ è½½åå°è¯•è‡ªåŠ¨æ’­æ”¾
  if (document.readyState === 'complete') {
    setTimeout(tryAutoplay, 500);
  } else {
    window.addEventListener('load', function() {
      setTimeout(tryAutoplay, 500);
    });
  }
  
  // åˆ‡æ¢æ’­æ”¾/æš‚åœ
  toggleBtn.addEventListener('click', function() {
    if (isPlaying) {
      player.pause();
      toggleBtn.textContent = 'â–¶';
      isPlaying = false;
    } else {
      player.play();
      toggleBtn.textContent = 'â¸';
      isPlaying = true;
    }
  });
  
  // éŸ³é‡æ§åˆ¶
  volumeControl.addEventListener('input', function() {
    const volume = this.value / 100;
    player.volume = volume;
    volumeDisplay.textContent = this.value + '%';
  });
  
  // æ·»åŠ ä¸€ä¸ªå°çš„æµ®åŠ¨æŒ‰é’®æ¥é‡æ–°æ˜¾ç¤ºæ’­æ”¾é¢æ¿
  const showMusicBtn = document.createElement('button');
  showMusicBtn.innerHTML = 'ğŸµ';
  showMusicBtn.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 999; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 50%; width: 50px; height: 50px; cursor: pointer; font-size: 20px; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4); display: none; transition: all 0.3s;';
  showMusicBtn.title = 'æ˜¾ç¤ºéŸ³ä¹æ§åˆ¶';
  document.body.appendChild(showMusicBtn);
  
  // æ˜¾ç¤ºæµ®åŠ¨æŒ‰é’®
  showMusicBtn.addEventListener('click', function() {
    musicPanel.style.display = 'block';
    showMusicBtn.style.display = 'none';
  });
  
  // å…³é—­æŒ‰é’® - å®Œå…¨éšè—æ’­æ”¾é¢æ¿
  closeBtn.addEventListener('click', function() {
    musicPanel.style.display = 'none';
    player.pause(); // å…³é—­æ—¶æš‚åœéŸ³ä¹
    isPlaying = false;
    toggleBtn.textContent = 'â–¶'; // æ›´æ–°æŒ‰é’®çŠ¶æ€
    
    // å»¶è¿Ÿæ˜¾ç¤ºæµ®åŠ¨æŒ‰é’®
    setTimeout(() => {
      showMusicBtn.style.display = 'block';
    }, 300);
  });
  
  // ç›‘å¬æ’­æ”¾çŠ¶æ€å˜åŒ–
  player.addEventListener('play', function() {
    toggleBtn.textContent = 'â¸';
    isPlaying = true;
  });
  
  player.addEventListener('pause', function() {
    toggleBtn.textContent = 'â–¶';
    isPlaying = false;
  });
  
})();
</script>

<style>
@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

#toggle-music-btn:hover {
  animation: pulse 0.6s ease-in-out;
  transform: scale(1.1);
}

#volume-control::-webkit-slider-thumb {
  appearance: none;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: #667eea;
  cursor: pointer;
}

#volume-control::-moz-range-thumb {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: #667eea;
  cursor: pointer;
  border: none;
}

@media (max-width: 768px) {
  div[style*="position: fixed"] {
    bottom: 10px !important;
    right: 10px !important;
    left: 10px !important;
    min-width: auto !important;
  }
}
</style>

