<!-- èƒŒæ™¯éŸ³ä¹æ’­æ”¾å™¨ï¼ˆéšè—UIï¼Œè‡ªåŠ¨æ’­æ”¾ï¼‰ -->
<div id="music-player" style="display: none;">
  <!-- éšè—çš„å°æ§åˆ¶æŒ‰é’®ï¼Œæ”¾åœ¨é¡µé¢å·¦ä¸‹è§’ -->
  <div style="position: fixed; bottom: 20px; left: 20px; z-index: 1000;">
    <button id="toggle-music-btn" style="background: rgba(0, 0, 0, 0.5); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 18px;" title="æ’­æ”¾/æš‚åœéŸ³ä¹">â¸</button>
  </div>
  
  <audio id="background-music" loop preload="none" volume="0.3">
    <!-- ä½¿ç”¨MP3æ ¼å¼ï¼Œå°†ä½ çš„éŸ³ä¹æ–‡ä»¶å‘½åä¸º background.mp3 å¹¶æ”¾åœ¨ static/music/ ç›®å½•ä¸‹ -->
    <source src="/huiwang/music/background.mp3" type="audio/mpeg">
    <!-- å…¼å®¹æ€§æç¤º -->
    ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
  </audio>
</div>

<script>
(function() {
  const player = document.getElementById('background-music');
  const toggleBtn = document.getElementById('toggle-music-btn');
  
  let isPlaying = true; // åˆå§‹çŠ¶æ€ä¸ºæ’­æ”¾ä¸­
  
  // å°è¯•è‡ªåŠ¨æ’­æ”¾
  function tryAutoplay() {
    // è®¾ç½®åˆå§‹éŸ³é‡
    player.volume = 0.3;
    
    const playPromise = player.play();
    
    if (playPromise !== undefined) {
      playPromise
        .then(() => {
          // è‡ªåŠ¨æ’­æ”¾æˆåŠŸ
          console.log('ğŸµ éŸ³ä¹è‡ªåŠ¨æ’­æ”¾æˆåŠŸ');
          isPlaying = true;
          toggleBtn.textContent = 'â¸';
        })
        .catch(error => {
          // è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢ï¼ˆæµè§ˆå™¨ç­–ç•¥ï¼‰
          console.log('âš ï¸ è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢:', error);
          isPlaying = false;
          toggleBtn.textContent = 'â–¶';
          console.log('ğŸ‘† è¯·ç‚¹å‡»å·¦ä¸‹è§’æŒ‰é’®æ‰‹åŠ¨æ’­æ”¾');
        });
    }
  }
  
  // é¡µé¢åŠ è½½åå°è¯•è‡ªåŠ¨æ’­æ”¾
  if (document.readyState === 'complete') {
    tryAutoplay();
  } else {
    window.addEventListener('load', function() {
      setTimeout(tryAutoplay, 500); // å»¶è¿Ÿ500msç¡®ä¿DOMå®Œå…¨åŠ è½½
    });
  }
  
  // åˆ‡æ¢æ’­æ”¾/æš‚åœ
  toggleBtn.addEventListener('click', function() {
    if (isPlaying) {
      player.pause();
      toggleBtn.textContent = 'â–¶';
      isPlaying = false;
    } else {
      player.play();
      toggleBtn.textContent = 'â¸';
      isPlaying = true;
    }
  });
  
  // ç›‘å¬æ’­æ”¾çŠ¶æ€å˜åŒ–
  player.addEventListener('play', function() {
    toggleBtn.textContent = 'â¸';
    isPlaying = true;
  });
  
  player.addEventListener('pause', function() {
    toggleBtn.textContent = 'â–¶';
    isPlaying = false;
  });
  
})();
</script>

